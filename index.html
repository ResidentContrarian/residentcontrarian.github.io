<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Author Filter — AND</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 24px; }
    #buttons { margin: 12px 0 20px; display: flex; flex-wrap: wrap; gap: 8px; }
    button { margin: 0; padding: 8px 12px; border: 1px solid #999; background: #eee; border-radius: 6px; cursor: pointer; }
    button.active { background:#333; color:#fff; border-color:#333; }
    #results { border: 1px solid #ccc; padding: 16px; min-height: 40px; border-radius: 6px; }
    .msg { color:#666; }
    a.card { display:block; padding:6px 0; }
  </style>
</head>
<body>
  <h1>Author Filter</h1>

  <div id="buttons"><span class="msg">Loading tags…</span></div>
  <div id="results"><span class="msg">Loading authors…</span></div>

  <script>
    let authors = [];
    let tags = [];
    const selected = new Set(); // active tags

    function renderButtons() {
      const box = document.getElementById("buttons");
      box.innerHTML = "";

      // Show All = clear selection
      const allBtn = document.createElement("button");
      allBtn.textContent = "Show All";
      allBtn.onclick = () => { selected.clear(); renderButtons(); renderResults(); };
      box.appendChild(allBtn);

      // One toggle button per tag
      tags.forEach(tag => {
        const btn = document.createElement("button");
        btn.textContent = tag.charAt(0).toUpperCase() + tag.slice(1);
        if (selected.has(tag)) btn.classList.add("active");
        btn.onclick = () => {
          selected.has(tag) ? selected.delete(tag) : selected.add(tag);
          renderButtons();
          renderResults();
        };
        box.appendChild(btn);
      });
    }

    function renderResults() {
      const box = document.getElementById("results");
      box.innerHTML = "";

      // AND logic: if any tags selected, author must include ALL of them
      let filtered = authors;
      if (selected.size) {
        filtered = authors.filter(a => {
          const t = Array.isArray(a.tags) ? a.tags : [];
          // every selected tag must be present on the author
          for (const s of selected) if (!t.includes(s)) return false;
          return true;
        });
      }

      if (!filtered.length) {
        box.innerHTML = `<p class="msg">No authors match this category.</p>`;
        return;
      }

      filtered.forEach(a => {
        const link = document.createElement("a");
        link.className = "card";
        link.href = a.url;
        link.textContent = a.name;
        box.appendChild(link);
      });
    }

    // cache-bust while testing
    const bust = `v=${Date.now()}`;
    Promise.all([
      fetch(`tags.json?${bust}`).then(r => { if (!r.ok) throw new Error("tags.json " + r.status); return r.json(); }),
      fetch(`authors.json?${bust}`).then(r => { if (!r.ok) throw new Error("authors.json " + r.status); return r.json(); })
    ])
    .then(([tagData, authorData]) => {
      tags = tagData;
      authors = authorData;
      renderButtons();
      renderResults(); // default: show all (no tags selected)
    })
    .catch(err => {
      console.error(err);
      document.getElementById("buttons").innerHTML =
        `<p style="color:#b00020;font-weight:600">Couldn't load data (${err.message}).</p>`;
      document.getElementById("results").innerHTML =
        `<p style="color:#b00020;font-weight:600">Couldn't load data (${err.message}).</p>`;
    });
  </script>
  <!DOCTYPE html>
<html>
<head>
  <title>My Site</title>
</head>
<body>
  <h1>Authors</h1>
  <ul id="authors-list"></ul>

  <script>
    fetch("/authors.json")
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("authors-list");
        data.forEach(author => {
          const li = document.createElement("li");
          li.textContent = author.name;
          list.appendChild(li);
        });
      });
  </script>
</body>
</html>
</body>
</html>
