<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Author Filter</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 24px; }
    #buttons { margin: 12px 0 20px; }
    button { margin: 4px 6px 0 0; padding: 8px 12px; border: 1px solid #999; background: #eee; border-radius: 6px; cursor: pointer; }
    #results { border: 1px solid #ccc; padding: 16px; min-height: 40px; border-radius: 6px; }
    .msg { color: #666; }
  </style>
</head>
<body>
  <h1>Author Filter</h1>

  <div id="buttons"><span class="msg">Loading tags…</span></div>
  <div id="results"><span class="msg">Loading authors…</span></div>

  <!-- Keep the script at the END of <body> so the DOM exists when we render -->
  <script>
    let authors = [];
    let tags = [];

    function renderButtons() {
      const buttonBox = document.getElementById("buttons");
      buttonBox.innerHTML = "";

      // Show All
      const allBtn = document.createElement("button");
      allBtn.textContent = "Show All";
      allBtn.onclick = () => filterAuthors("all");
      buttonBox.appendChild(allBtn);

      // One per tag
      tags.forEach(tag => {
        const btn = document.createElement("button");
        btn.textContent = tag.charAt(0).toUpperCase() + tag.slice(1);
        btn.onclick = () => filterAuthors(tag);
        buttonBox.appendChild(btn);
      });
    }

    function filterAuthors(tag) {
      const box = document.getElementById("results");
      box.innerHTML = "";

      let filtered = authors;
      if (tag !== "all") {
        filtered = authors.filter(a => Array.isArray(a.tags) && a.tags.includes(tag));
      }

      if (!filtered.length) {
        box.innerHTML = `<p class="msg">No authors match this category.</p>`;
        return;
      }

      filtered.forEach(a => {
        const link = document.createElement("a");
        link.href = a.url;
        link.textContent = a.name;
        link.style.display = "block";
        box.appendChild(link);
      });
    }

    // Cache-bust while testing so stale JSON doesn't hang us
    const bust = `v=${Date.now()}`;

    Promise.all([
      fetch(`tags.json?${bust}`).then(r => { if (!r.ok) throw new Error("tags.json " + r.status); return r.json(); }),
      fetch(`authors.json?${bust}`).then(r => { if (!r.ok) throw new Error("authors.json " + r.status); return r.json(); })
    ])
    .then(([tagData, authorData]) => {
      tags = tagData;        // e.g., ["horror","fantasy","sci-fi",...]
      authors = authorData;  // e.g., [{name,url,tags:[...]}]

      renderButtons();
      filterAuthors("all");  // default view
    })
    .catch(err => {
      console.error(err);
      document.getElementById("buttons").innerHTML =
        `<p style="color:#b00020;font-weight:600">Couldn't load data (${err.message}).</p>`;
      document.getElementById("results").innerHTML =
        `<p style="color:#b00020;font-weight:600">Couldn't load data (${err.message}).</p>`;
    });
  </script>
</body>
</html>
