<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Author Filter</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 24px; }
    #buttons { margin: 12px 0 20px; display: flex; flex-wrap: wrap; gap: 8px; }
    button.tag { padding: 8px 12px; border: 1px solid #999; background: #eee; cursor: pointer; border-radius: 6px; }
    button.tag.active { background: #333; color: #fff; border-color: #333; }
    button.small { padding: 6px 10px; }
    .badge { font-size: 0.85em; opacity: 0.8; margin-left: 6px; }
    #results { border: 1px solid #ccc; padding: 16px; min-height: 40px; border-radius: 6px; }
    .msg { color: #666; }
    a.card { display: block; padding: 8px 0; }
  </style>
</head>
<body>
  <h1>Author Filter</h1>

  <div id="buttons">
    <span class="msg">Loading tags…</span>
  </div>

  <div id="results"><span class="msg">Loading authors…</span></div>

  <script>
    let authors = [];
    let tags = [];
    const selected = new Set(); // active tag filters

    // util: parse & write URL query ?tags=a,b
    function getTagsFromURL() {
      const p = new URLSearchParams(location.search);
      const raw = (p.get("tags") || "").trim();
      return raw ? raw.split(",").map(s => s.trim()).filter(Boolean) : [];
    }
    function setTagsInURL(list) {
      const p = new URLSearchParams(location.search);
      if (list.length) p.set("tags", list.join(","));
      else p.delete("tags");
      history.replaceState(null, "", `?${p.toString()}`);
    }

    // build buttons (with counts)
    function renderButtons() {
      const box = document.getElementById("buttons");
      box.innerHTML = "";

      // Show All / Clear button
      const allBtn = document.createElement("button");
      allBtn.className = "small tag";
      allBtn.textContent = "Show All";
      allBtn.onclick = () => {
        selected.clear();
        setTagsInURL([]);
        renderButtons();
        renderResults();
      };
      box.appendChild(allBtn);

      // compute counts per tag (how many authors include each tag)
      const counts = Object.fromEntries(tags.map(t => [t, 0]));
      authors.forEach(a => (a.tags || []).forEach(t => { if (counts[t] != null) counts[t]++; }));

      // one button per tag
      tags.forEach(tag => {
        const btn = document.createElement("button");
        btn.className = "tag" + (selected.has(tag) ? " active" : "");
        btn.textContent = tag.charAt(0).toUpperCase() + tag.slice(1);

        // add a small count badge
        const b = document.createElement("span");
        b.className = "badge";
        b.textContent = `(${counts[tag]})`;
        btn.appendChild(b);

        btn.onclick = () => {
          if (selected.has(tag)) selected.delete(tag);
          else selected.add(tag);
          setTagsInURL([...selected]);
          renderButtons();
          renderResults();
        };
        box.appendChild(btn);
      });
    }

    // results area
    function renderResults() {
      const box = document.getElementById("results");
      box.innerHTML = "";

      // if none selected, show all
      let
